@{
    ViewBag.Title = "Home Page";
}
<input type="text" id="keyword" placeholder="Keyword" size="50"/>
<input type="button" value="SEARCH" onclick="btnSearch_Click()"/>
<br/><br/>

<table id="video-list" class="table table-striped"></table>

<table>
    <tr>
        <td>Id</td>
        <td>
            <input type="text" id="video-id" readonly="true"/>
        </td>
    </tr>
    <tr>
        <td>Uploader</td>
        <td>
            <input type="text" id="video-uploader" size="50"/>
        </td>
    </tr>
    <tr>
        <td>Title</td>
        <td>
            <input type="text" id="video-title" size="50"/>
        </td>
    </tr>
    <tr>
        <td>Description</td>
        <td>
            <input type="text" id="video-description" size="50"/>
        </td>
    </tr>
    <tr>
        <td>Tags</td>
        <td>
            <input type="text" id="video-tags" size="50"/>
        </td>
    </tr>
    <tr>
        <td>URL</td>
        <td>
            <input type="text" id="video-url" size="50"/>
        </td>
    </tr>
    <tr>
        <td>Timestamp</td>
        <td>
            <input type="text" id="video-timestamp" size="50"/>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <input type="button" value="ADD NEW" onclick="btnAdd_Click()"/>
            <input type="button" value="UPDATE" onclick="btnUpdate_Click()"/>
            <input type="button" value="DELETE" onclick="btnDelete_Click()"/>
        </td>
    </tr>
</table>

<div id="loader-wrapper">
    <div class="loader"></div>
</div>

<script src="~/Scripts/jquery-3.3.1.min.js"
        type="text/javascript"></script>
<script type="text/javascript">
    function btnSearch_Click() {
        const keyword = document.getElementById("keyword").value.trim();
        if (keyword.length > 0) search(keyword);
        else getAllVideos();
    }

    function btnAdd_Click() {
        const newVideo = {
            id: 0,
            uploader: document.getElementById("video-uploader").value,
            title: document.getElementById("video-title").value,
            description: document.getElementById("video-description").value,
            tags: document.getElementById("video-tags").value,
            url: document.getElementById("video-url").value,
            timestamp: document.getElementById("video-timestamp").value
        };
        addNew(newVideo);
    }

    function btnUpdate_Click() {
        const newVideo = {
            id: document.getElementById("video-id").value,
            uploader: document.getElementById("video-uploader").value,
            title: document.getElementById("video-title").value,
            description: document.getElementById("video-description").value,
            tags: document.getElementById("video-tags").value,
            url: document.getElementById("video-url").value,
            timestamp: document.getElementById("video-timestamp").value
        };
        updateVideo(newVideo);
    }

    function btnDelete_Click() {
        if (confirm("ARE YOU SURE ?")) {
            const code = document.getElementById("video-id").value;
            deleteVideo(code);
        }
    }

/* business methods */
    function getAllVideos() {
        setSpinner(true);
        $.get("/Home/GetAllVideos",
            (videos) => {
                renderVideoTable(videos);
                setSpinner(false);
            });
    }

    function getDetails(id) {
        setSpinner(true);
        $.get("/Home/GetDetails",
            { "id": id },
            (video) => {
                renderVideoDetails(video);
                setSpinner(false);
            });
    }

    function search(keyword) {
        setSpinner(true);
        $.get("/Home/Search",
            { "keyword": keyword },
            (videos) => {
                renderVideoTable(videos);
                setSpinner(false);
            });
    }

    function addNew(newVideo) {
        setSpinner(true);
        $.post("/Home/Add",
            { "video": newVideo },
            (status) => {
                setSpinner(false);
                if (status) {
                    getAllVideos();
                    clearTextboxes();
                } else alert("FAILED!");
            });
    }

    function updateVideo(newVideo) {
        setSpinner(true);
        $.post("/Home/Update",
            { "video": newVideo },
            (status) => {
                setSpinner(false);
                if (status) {
                    getAllVideos();
                    clearTextboxes();
                } else alert("FAILED!");
            });
    }

    function deleteVideo(id) {
        setSpinner(true);
        $.get("/Home/Delete",
            { "id": id },
            (status) => {
                if (status) {
                    getAllVideos();
                    clearTextboxes();
                } else alert("FAILED!");
            });
    }

    function renderVideoTable(videos) {
        const header = `
                    <tr>
                        <th>Id</th>                        
                        <th>Title</th>
                        <th>Uploader</th>
                        <th>Description</th>
                        <th>Tags</th>
                        <th>URL</th>
                        <th>Timestamp</th>
                    </tr>
                   `;
        let row = "";
        for (let video of videos) {
            row += `
                    <tr onclick = 'getDetails(${video.id})'>
                      <td>${video.id}</td>
                      <td>${video.title}</td>
                      <td>${video.uploader}</td>
                      <td>${video.description}</td>
                      <td>${video.tags}</td>
                      <td>${video.url}</td>
                      <td>${video.timestamp}</td>
                    </tr>
                    `;
        }
        document.getElementById("video-list").innerHTML = header + row;
    }

    function setSpinner(visible) {
        const spinner = document.getElementById("loader-wrapper");
        if (visible) spinner.style.display = "flex";
        else spinner.style.display = "none";
    }

    function renderVideoDetails(video) {
        document.getElementById("video-id").value = video.id;
        document.getElementById("video-uploader").value = video.uploader;
        document.getElementById("video-title").value = video.title;
        document.getElementById("video-description").value = video.description;
        document.getElementById("video-tags").value = video.tags;
        document.getElementById("video-url").value = video.url;
        document.getElementById("video-timestamp").value = video.timestamp;
    }

    function clearTextboxes() {
        document.getElementById("video-id").value = "";
        document.getElementById("video-uploader").value = "";
        document.getElementById("video-title").value = "";
        document.getElementById("video-description").value = "";
        document.getElementById("video-tags").value = "";
        document.getElementById("video-url").value = "";
        document.getElementById("video-timestamp").value = "";
    }

    getAllVideos();
</script>